<?xml version="1.0"?>
<!DOCTYPE tsung SYSTEM "usr/local/share/tsung/tsung-1.0.dtd" [
  <!ENTITY ip SYSTEM "ip.txt">
  <!ENTITY interarrival SYSTEM "interarrival.txt">
  <!ENTITY heavyindex "30"> <!-- Until 30 is easy, 35 stays more ore less 6 seconds, 50 is heavy, 300 is impossible -->
]>
<tsung loglevel="notice" version="1.0">

  <!-- Client side setup -->
  <clients>
    <client host="localhost" use_controller_vm="true" maxusers="10000"/>
  </clients>
  
  <!-- Server side setup -->
  <servers>
    <server host="&ip;" port="8080" type="tcp"></server>
  </servers>

  <!-- to start os monitoring (cpu, network, memory). Use an erlang
  agent on the remote machine or SNMP. erlang is the default --> 
  <monitoring>
    <monitor host="myserver" type="snmp"></monitor>
  </monitoring>
  
  <load>
  <!-- several arrival phases can be set: for each phase, you can set
  the mean inter-arrival time between new clients and the phase
  duration -->
   <arrivalphase phase="1" duration="15" unit="minute">

    <users interarrival="&interarrival;" unit="second"></users>

   </arrivalphase>
  </load>

  <options>
   <option type="ts_http" name="user_agent">
    <user_agent probability="80">Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.7.8) Gecko/20050513 Galeon/1.3.21</user_agent>
    <user_agent probability="20">Mozilla/5.0 (Windows; U; Windows NT 5.2; fr-FR; rv:1.7.8) Gecko/20050511 Firefox/1.0.4</user_agent>
   </option>
  </options>

  <!-- start a session for a http user. the probability is the
  frequency of this type os session. The sum of all session's
  probabilities must be 100 -->

 <sessions>
  <session name='session_1' probability='100'  type='ts_http'>
    <transaction name="think">	  
      <request><http url='http://&ip;' version='1.1' method='GET'>
       <http_header name='Accept' value='text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8' />
       <http_header name='Accept-Encoding' value='gzip, deflate' />
       <http_header name='Accept-Language' value='en-GB,en;q=0.5' /></http></request>

      <thinktime random='true' value='5'/>
    </transaction>

    <transaction name="req">
      <request><http url='http://&ip;:8080/compile' version='1.1'  contents='{&quot;code&quot;:&quot;template%20%3Cint%20i%3E%5Cnclass%20A%5Cn%7B%5Cn%20%20%20%20A%3Ci%20-%201%3E%20x%3B%5Cn%20%20%20%20A%3Ci%20-%202%3E%20y%3B%5Cn%7D%3B%5Cn%5Cntemplate%20%3C%3E%5Cnclass%20A%3C0%3E%5Cn%7B%5Cn%20%20%20%20char%20a%3B%5Cn%7D%3B%5Cn%5Cntemplate%20%3C%3E%5Cnclass%20A%3C1%3E%5Cn%7B%5Cn%20%20%20%20char%20a%3B%5Cn%7D%3B%5Cn%5Cnint%20main%28%29%5Cn%7B%5Cn%20%20%20%20A%3C&heavyindex;%3E%20b%3B%5Cn%20%20%20%20return%200%3B%5Cn%7D&quot;,&quot;cflags&quot;:&quot;&quot;,&quot;clientId&quot;:&quot;A5UDTHgG4Mf4skzuAAAJ&quot;}' content_type='application/json' method='POST'>
        <http_header name='Accept' value='application/json, text/plain, */*' />
        <http_header name='Accept-Encoding' value='gzip, deflate' />
        <http_header name='Accept-Language' value='en-GB,en;q=0.5' /></http></request>
    </transaction>
  </session>
 </sessions>
</tsung>

